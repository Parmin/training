Exercise: Creating a TTL Index
------------------------------

Create a TTL index on the 'ttl' collection that will delete documents older
than 30 seconds. Write a script that will insert documents at a rate of one
per second.

.. code-block:: javascript

    db.ttl.ensureIndex( { a : 1 }, { expireAfterSeconds : 30 } )
    i = 0
    while (true) {
        i += 1;
        db.foo.insert( { a : ISODate(), b : i } );
        sleep(1000);  // Sleep for 1 second
    }

Then, leaving that window open, open up a new terminal and connect to the
database with the mongo shell. This will allow us to verify the TTL behavior.

.. code-block:: javascript

    // look at the output and wait. After a ramp-up of up to a minute or so,
    // count() will be reset to 30 once/minute.
    while (true) {
        print(db.foo.count());
        sleep(100);
    } 
