==============
Authentication
==============

Learning Objectives
-------------------

Upon completing this module, you should understand:

- Authentication Mechanisms
- External Authentication
- Native Authentication
- Internal Node Authentication
- Configuration of Authentication Mechanisms

.. include:: /includes/student-notes.rst


Authentication
--------------

Authentication is a common concept around:

- Validating identities
- Managing certificates / credentials
- Allowing accounts to connect and operate with data

MongoDB has 2 Authentication Systems:

- Native: MongoDB manages
- External: Services that we use to Authenticate accounts

.. include:: /includes/student-notes.rst


Authentication Mechanisms
-------------------------

MongoDB comes with different Authentication Mechanisms:

- SCRAM-SHA-1 (default >= 3.0)
- MONGODB-CR (legacy)
- X509 Certificates
- LDAP (MongoDB Enterprise)
- Kerberos (MongoDB Enterprise)

.. include:: /includes/student-notes.rst

.. only:: instructor

  .. note::

    Important to refer to the students that SCRAM-SHA-1 and MongoDB-CR are native mechanisms in the sense that they are fully managed by MongoDB instances.

    - X509 can also be considered native in terms of management but they rely on certificates generated by 3rd parties and only enforced by MongoDB
    - LDAP and Kerberos are external authentication mechanisms and are only available with MongoDB enterprise version


Internal Authentication
-----------------------

For Internal Authentication purposes (mechanism used by Replica Nodes and Shards) MongoDB relies in:
- Keyfiles

  - Shared password file used by replica set members
  - Hexadecimal value of 6 to 1024 chars length

- X509 Certificates

.. include:: /includes/student-notes.rst


Simple Authentication Configuration
-----------------------------------

To get start we just need to make sure we are enabling our `mongod` instances with `--auth` parameter enabled.

.. code-block:: bash

  mongod --dbpath /data/db --auth

For any connections to be established to this `mongod` instance the system will require a **user** and **password**.

.. code-block:: bash

  mongo -u user -p                                                                                                                                                                                                                 [13:13:52]
  MongoDB shell version: 3.2.0
  Enter password:

.. include:: /includes/student-notes.rst

.. only:: instructor

  .. note::

    - A single `--auth` parameter will only enforce mongod to enable authentication.
    - Please remind students that you need to create users ahead of enabling authentication.
    - In the case of replica sets the system will also require `--keyFile` to be provided.

    You can take the opportunity to ask:

    - Q: what happens if we just launch a mongod without having any users created ?

      - A: nothing happens, we just can't access the instance.
    
