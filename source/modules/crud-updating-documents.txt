==================
Updating Documents
==================

Learning Objectives
-------------------

Upon completing this module students should understand

- The ``update()`` method
- The required parameters for ``update()``
- Field update operators
- Array update operators


The ``update()`` Method
-----------------------

- Mutate documents in MongoDB using ``update()``.
- ``update()`` requires two parameters:

  - A query document used to select documents to be updated.

  - An update document that specifies how selected documents will change.


- ``update()`` cannot delete a document


Parameters to ``update()``
--------------------------

- Keep the following in mind regarding the required parameters for ``update()``
- The query parameter:

    - Use the same syntax as with ``find()``.
    - By default only the first document found is updated.

- The update parameter:

    - Take care to simply modify documents if that is what you intend.
    - Replacing documents in the entirety is easy to do by mistake.


.. include:: /exercises/crud-basic-queries-using-update.txt


``update()`` Defaults to one Document
-------------------------------------

- By default, ``update()`` modifies the first document found that matches the query.
- The default use case is one where there is only one document that fits the query.
- This is to reduce the chances of unintended collection scans for updates.



Updating Multiple Documents
---------------------------

- In order to update multiple documents, we use the third (optional) parameter to ``update()``.
- The third parameter is an options document.
- Specify ``multi : true`` as one field in this document.
- Bear in mind that without an appropriate index, you may scan every document in the collection.


.. include:: /exercises/crud-multi-update.txt


Updating Fields
---------------

- Update one or more fields using the ``$set`` operator.
- If the field already exists, using ``$set`` will change its value.
- If the field does not exist, ``$set`` will create it and set it to the new value.
- Any fields you do not specify will not be modified.
- You can remove a field using ``$unset``.


.. include:: /exercises/crud-set-and-unset.txt


.. following document doesn't exist. commenting to prevent error

   .. include /exercises/crud-set-with-multi.txt


Update Operators
----------------

- ``$inc``: Increment a field's value by the specified amount.
- ``$mul``: Multiply a field's value by the specified amount.
- ``$rename``: Rename a field.
- ``$set`` (already discussed)
- ``$unset`` (already discussed)
- ``$min``: Only update the value if it is smaller than the specified quantity
- ``$max``: Only update the value if it is larger than the specified quantity
- ``$currentDate``: Set the value of a field to the current :manual:`Date or timestamp</reference/operator/update/currentDate/>`.


.. include:: /exercises/crud-update-operators.txt


Array Operators
---------------

- These operators may be applied to array fields.
- ``$push``: Appends an element to the end of the array.
- ``$pushAll``: Appends multiple elements to the end of the array.
- ``$pop``: Removes one element from the end of the array.
- ``$pull``: Removes all elements in the array that match a specified value.
- ``$pullAll``: Removes all elements in the array that match any of the specified values.
- ``$addToSet``: Appends an element to the array if not already present.


.. include:: /exercises/crud-update-array-operators.txt
