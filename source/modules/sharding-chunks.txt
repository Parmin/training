=================
Sharding - Chunks
=================

Learning Objectives
-------------------

Upon completing this module, students should understand:

- The status of chunks in a newly sharded collection
- When chunk splits automatically occur
- Advantages of pre-splitting chunks
- How chunks can grow imbalanced


Chunks in a Newly Sharded Collection
------------------------------------

- When a collection is sharded, it will start with one chunk

  - Its range will be from { $minKey : 1 } to { $maxKey : 1 }
  - These are range values that the key cannot take but are lower than or higher than all other values, regardless of type.

- This chunk will start out on the Primary Shard for that database (which is the server that holds all unsharded collections).


Chunk Splits
------------

- When a chunk gets larger than 64 MB, it gets split, roughly in half

  - Exactly in half isn't always possible.
  - The chunk can only be split between two values of a shard key

    - This is why the shard key's cardinality is important

- The split is just a bookkeeping entry in the metadata. No data bearing documents are altered.
- The chunk stays in place; it doesn't move until a migration is started.
- If a migration is happening, no chunk splits will happen.

Pre-Splitting Chunks
--------------------

- You can manually pre-split chunks, and either let the balancer migrate the empty chunks to different shards, or manually place them where they belong.
- Manually pre-splitting is useful if:

  - You plan to do a large data import early on, which will take time to split and balance automatically.
  - You expect a heavy initial server load, and want to partition your writes across your cluster.

- Pre-splitting the chunks will ensure that the documents inserted go where they belong.
