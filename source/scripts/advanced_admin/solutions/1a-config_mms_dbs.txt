### In this section, we create the dirs for the APPDB and BACKUPDB,
### then start the 6 mongod processes
### You can follow the instructions below or run:
###
### > cd <script/advanced_admin>
### > ./manage.py --profile <myregion> --teams <team1,2,...> --roles OpsMgr1,OpsMgr2,OpsMgr3 --run <myclass> --cmd solutions/1a-config_mms_dbs.txt
###
### Then move to part "1b...txt" to initialize and complete the 2 replica sets

### on OpsMrg1, OpsMgr2 and OpsMgr3

cd /data
tar -xf downloads/mongodb-linux-x86_64-enterprise-rhel70-3.2.*.tgz
mv mongodb-linux-x86_64-enterprise-rhel70-3.2.*/ mongodb

# For the APPDB
mkdir -p /mongod-data/appdb/data
cat <<EOFAPP > etc/appdb.conf
net:
  port: 27001
processManagement:
  fork: true
replication:
  replSetName: "APPDB"
  oplogSizeMB: 100
storage:
  dbPath: /mongod-data/appdb/data
  wiredTiger:
    engineConfig:
      cacheSizeGB: 2
      journalCompressor: zlib
systemLog:
  destination: file
  path: /var/log/mongodb/appdb.log
  logAppend: true
EOFAPP
mongodb/bin/mongod --config etc/appdb.conf

# For the BACKUPDB
mkdir /mongod-data/backupdb/data
cat <<EOFBACKUP > etc/backupdb.conf
net:
  port: 27002
processManagement:
  fork: true
replication:
  replSetName: "BACKUPDB"
  oplogSizeMB: 100
storage:
  dbPath: /mongod-data/backupdb/data
  wiredTiger:
    engineConfig:
      cacheSizeGB: 2
      journalCompressor: zlib
systemLog:
  destination: file
  path: /var/log/mongodb/backupdb.log
  logAppend: true
EOFBACKUP
mongodb/bin/mongod --config etc/backupdb.conf
